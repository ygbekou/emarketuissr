<table mat-table [dataSource]="poDtlDatasource" matSort class="w-100">

  <!-- ID Column -->
  <ng-container matColumnDef="id">
    <th mat-header-cell width="5%" *matHeaderCellDef mat-sort-header> ID </th>
    <td mat-cell *matCellDef="let poDtl"> {{poDtl.id}} </td>
  </ng-container>

  <!-- Image Column -->
  <ng-container matColumnDef="image">
    <th mat-header-cell width="10%" *matHeaderCellDef mat-sort-header> {{'COMMON.IMAGE' | translate}} </th>
    <td mat-cell *matCellDef="let poDtl">
      <img
        [src]="'assets/images/products/'+(poDtl.product?.image?(poDtl.product.id+'/'+poDtl.product?.image):'default.png')"
        [style.width.px]="25" class="d-block">
    </td>
  </ng-container>

  <ng-container matColumnDef="productName">
    <th mat-header-cell width="30%" *matHeaderCellDef mat-sort-header> {{'COMMON.PRODUCT' | translate}}</th>
    <td mat-cell *matCellDef="let poDtl" class="p-1">
      <mat-form-field appearance="outline" class="w-100">
        <input type="text" placeholder="{{'COMMON.SELECT'|translate}}" aria-label="Number" name="currentOption" matInput
          [matAutocomplete]="auto" [(ngModel)]="poDtl.productName" required
          (ngModelChange)="poDtl.isTouched = true; filterOptions(poDtl.productName)">
        <mat-autocomplete id="option1" #auto="matAutocomplete">
          <mat-option *ngFor="let option of filteredProductOptions " (onSelectionChange)="poDtl.isTouched = true; 
                  poDtl.product.id = option.product.id" [value]="option.name">
            {{option.name}}
          </mat-option>
        </mat-autocomplete>
      </mat-form-field>
      <mat-error *ngIf="poDtl.isTouched && !validateSelectedProduct(poDtl)" severity="error">
        {{ 'VALIDATION.FIELD_REQUIRED' | translate }} - {{ 'VALIDATION.PLEASE_SELECT_FROM_DROPDOWN' | translate }}
      </mat-error>
    </td>
  </ng-container>

  <ng-container matColumnDef="ingredientName">
    <th mat-header-cell width="30%" *matHeaderCellDef mat-sort-header> {{'COMMON.INGREDIENT' | translate}}</th>
    <td mat-cell *matCellDef="let poDtl" class="p-1">
      <mat-form-field appearance="outline" class="w-100">
        <input type="text" placeholder="{{'COMMON.SELECT'|translate}}" aria-label="Number" name="currentOption" matInput
          [matAutocomplete]="auto" [(ngModel)]="poDtl.ingredientName" required
          (ngModelChange)="poDtl.isTouched = true; filterIngredientOptions(poDtl.productName)">
        <mat-autocomplete id="option1" #auto="matAutocomplete">
          <mat-option *ngFor="let option of filteredIngredientOptions " (onSelectionChange)="poDtl.isTouched = true; 
                  poDtl.ingredient.id = option.ingredient.id" [value]="option.ingredient.name">
            {{option.ingredient.name}}
          </mat-option>
        </mat-autocomplete>
      </mat-form-field>
      <mat-error *ngIf="poDtl.isTouched && !validateSelectedIngredient(poDtl)" severity="error">
        {{ 'VALIDATION.FIELD_REQUIRED' | translate }} - {{ 'VALIDATION.PLEASE_SELECT_FROM_DROPDOWN' | translate }}
      </mat-error>
    </td>
  </ng-container>


  <!-- Quantity Column -->
  <ng-container matColumnDef="quantity">
    <th mat-header-cell width="10%" *matHeaderCellDef mat-sort-header> {{'COMMON.QUANTITY' | translate}} </th>
    <td mat-cell *matCellDef="let poDtl">
      <mat-form-field appearance="outline">
        <input type="text" aria-label="Number" name="quantity" matInput [(ngModel)]="poDtl.quantity" required
          (ngModelChange)="poDtl.isTouched = true; calculateTotalAmount(poDtl);">
      </mat-form-field>
    </td>
  </ng-container>

  <!-- Unit Price Column -->
  <ng-container matColumnDef="unitPrice">
    <th mat-header-cell width="10%" *matHeaderCellDef mat-sort-header> {{'COMMON.UNIT_PRICE' | translate}} </th>
    <td mat-cell *matCellDef="let poDtl">
      <mat-form-field appearance="outline">
        <input type="text" aria-label="Number" name="unitPrice" matInput [(ngModel)]="poDtl.unitAmount" required
          (ngModelChange)="poDtl.isTouched = true; calculateTotalAmount(poDtl);">
      </mat-form-field>
    </td>
  </ng-container>

  <!-- Total Amount Column -->
  <ng-container matColumnDef="totalAmount">
    <th mat-header-cell width="10%" *matHeaderCellDef mat-sort-header> {{'COMMON.TOTAL'|translate}} </th>
    <td mat-cell *matCellDef="let poDtl"> {{poDtl.totalAmount}}
    </td>
  </ng-container>

  <!--   Column -->
  <ng-container matColumnDef="actions">
    <th mat-header-cellwidth="20%" *matHeaderCellDef> Actions
      <a (click)="addPoDtl()" mat-icon-button color="primary" matTooltip="{{'COMMON.ADD' | translate}}">
        <mat-icon color="primary" class="mat-icon-xlg">add_circle</mat-icon>
      </a>
    </th>
    <td mat-cell *matCellDef="let poDtl">
      <button mat-icon-button color="primary" (click)="savePoDtl(poDtl)" matTooltip="{{'COMMON.SAVE' | translate}}"
        [disabled]="!poDtl.isTouched || poDtl.id > 0" class="remove">
        <mat-icon>save</mat-icon>
      </button>
      &nbsp;&nbsp;
      <button mat-icon-button color="warn" (click)="removePoDtl(poDtl)" matTooltip="{{'COMMON.DELETE' | translate}}"
        [disabled]="poDtl.id > 0" class="remove">
        <mat-icon>delete</mat-icon>
      </button>
    </td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="poDtlColumns"></tr>
  <tr mat-row *matRowDef="let poDtl; columns: poDtlColumns;">
  </tr>

</table>
<p *ngIf="dataSource?.data.length === 0" class="py-5 mb-0 text-center">{{'MESSAGE.NO_DATA' | translate}}</p>
<mat-paginator [pageSizeOptions]="[5, 10, 25, 100]" showFirstLastButtons></mat-paginator>